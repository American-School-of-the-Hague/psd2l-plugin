<queries>
	<!--set name here (also applies to permissions_root-->
    <query name="com.txoof.brightspace.parents.usernames" coreTable="guardian" flattened="false">
		<!--add description here-->
        <description>export all active students grades 5-13 for use with a BrightSpace 7-User import</description>
		<!--number of columns here must match number sql returns-->
        <columns>
			<column column="GUARDIAN.GUARDIANID">type</column> <!-- for columns not in database use a core filed-->
			<column column="GUARDIAN.GUARDIANID">action</column> <!-- for columns not in database use a core filed-->
			<column column="PCAS_ACCOUNT.USERNAME">username</column> 
			<column column="GUARDIAN.GUARDIANID">org_defined_id</column>
			<column column="GUARDIAN.FIRSTNAME">first_name</column>
			<column column="GUARDIAN.LASTNAME">last_name</column>
			<column column="GUARDIAN.GUARDIANID">password</column>
			<column column="GUARDIAN.GUARDIANID">is_active</column>
			<column column="GUARDIAN.GUARDIANID">role_name</column>
			<column column="PCAS_EMAILCONTACT.EMAILADDRESS">email</column>
			<column column="GUARDIAN.GUARDIANID">relationships</column>
			<column column="GUARDIAN.GUARDIANID">pref_first_name</column>
			<column column="GUARDIAN.GUARDIANID">pref_last_name</column>
 		</columns>
		<!--SQL query in format <![CDATA[QUERY]]>-->
        <sql>
			<![CDATA[
				select distinct
					'user' as "type",
					'UPDATE' as "action",
					pcas_account.username as "username",
					'P_'||GUARDIAN.GUARDIANID as "org_defined_id",
					GUARDIAN.FIRSTNAME as "firstname",
					GUARDIAN.LASTNAME as "lastname",
					'welcomeash' as "password",
					1 as "is_active",
					'parent' as "role",
					pcas_emailcontact.emailaddress as "email",
					'' as "relationships",
					'' as "pref_first_name",
					'' as "pref_last_name"
				
					/*
					GUARDIAN.GUARDIANID as GUARDIANID,
					GUARDIAN.FIRSTNAME as FIRSTNAME,
					GUARDIAN.LASTNAME as LASTNAME,
					GUARDIAN.EMAIL as EMAIL,
					GUARDIANSTUDENT.STUDENTSDCID as STUDENTSDCID,
					STUDENTS.LASTFIRST as LASTFIRST,
					STUDENTS.ENROLL_STATUS as ENROLL_STATUS 
					*/
				from 
				Guardian Guardian
				
				INNER JOIN 
				GuardianStudent GuardianStudent 
				ON 
				Guardian.GuardianID = GuardianStudent.GuardianID
				
				INNER JOIN 
				Students Students 
				ON 
				GuardianStudent.studentsdcid = Students.dcid
				
				INNER JOIN 
				PCAS_Account PCAS_Account 
				ON 
				Guardian.AccountIdentifier = PCAS_Account.PCAS_AccountToken
				
				INNER JOIN 
				PCAS_EmailContact PCAS_EmailContact 
				ON 
				PCAS_Account.PCAS_AccountID = PCAS_EmailContact.PCAS_AccountID
				where Students.enroll_status = 0
				order by "org_defined_id"
			]]>
        </sql>
    </query>

</queries>