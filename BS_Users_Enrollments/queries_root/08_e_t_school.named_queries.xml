<queries>
    <!--set name here (also applies to permissions_root-->
    <query name="com.txoof.brightspace.enroll.08_teacher_school" coreTable="TEACHERS" flattened="false">
        <!--add description here-->
        <description>enroll teachers in their home schools</description>
        <!--number of columns here must match number sql returns-->
        <columns>
            <column column="TEACHERS.ID">type</column>
            <column column="TEACHERS.ID">action</column>
            <column column="TEACHERS.TEACHERNUMBER">child_code</column>
            <column column="TEACHERS.ID">role_name</column>
            <column column="TEACHERS.HOMESCHOOLID">parent_code</column>
         </columns>
        <!--SQL query in format <![CDATA[QUERY]]>-->
        <sql>
            <![CDATA[
            /*
            08_e_t_school.named_queries.xml
            add staff w/ specific roles set in SIS
            Start Page > Staff > Select A Staff Member > Integration Information
            Always change roles at the HOME SCHOOL level in SIS
            */
            select distinct
                'enrollment' as "type",
                'UPDATE' as "action",
                'T_'||teachers.teachernumber as "child_code",
                case 
                    when U_SCHOOLSTAFFUSERFIELDS.BRIGHTSPACE_ACCOUNT_TYPE is Null or lower(trim(U_SCHOOLSTAFFUSERFIELDS.BRIGHTSPACE_ACCOUNT_TYPE)) = lower('NONE')
                    Then 'Instructor'
                    ELSE trim(U_SCHOOLSTAFFUSERFIELDS.BRIGHTSPACE_ACCOUNT_TYPE)
                end  as "role_name",
                teachers.homeschoolid as "parent_code"
            from TEACHERS TEACHERS,
            U_SCHOOLSTAFFUSERFIELDS U_SCHOOLSTAFFUSERFIELDS
            where teachers.status =1
                and length(teachers.email_addr) >0
                and teachers.schoolid = teachers.homeschoolid
                and u_schoolstaffuserfields.schoolstaffdcid = teachers.dcid
            order by teachers.homeschoolid
            ]]>
        </sql>
    </query>

</queries>