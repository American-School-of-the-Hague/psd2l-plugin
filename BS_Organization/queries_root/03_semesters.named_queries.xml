<queries>
    <!--set name here (also applies to permissions_root-->
    <query name="com.txoof.brightspace.org.03semesters" coreTable="terms" flattened="false">
        <!--add description here-->
        <description>active students</description>
        <!--number of columns here must match number sql returns-->
        <columns>
            <column column="TERMS.ID">type</column>
            <column column="TERMS.ID">action</column>
            <column column="TERMS.ID">code</column>
            <column column="TERMS.NAME">name</column>
            <column column="TERMS.FIRSTDAY">start_date</column>
            <column column="TERMS.LASTDAY">end_date</column>
            <column column="TERMS.LASTDAY">is_active</column>
            <column column="TERMS.ID">department_code</column>
            <column column="TERMS.ID">template_code</column>
            <column column="TERMS.ID">semester_code</column>
            <column column="TERMS.ID">offering_code</column>
            <column column="TERMS.ID">custom_code</column>			
         </columns>
        <!--SQL query in format <![CDATA[QUERY]]>-->
        <sql>
            <![CDATA[
            select distinct
                'semester' as "type",
                'UPDATE' as "action",
                'term_'||TERMS.ID as "code",
                /*
                post-pend the school year to the abbreviated term name using the current year and month
                */
                CASE 
                WHEN (EXTRACT(month from sysdate) >= 1 and EXTRACT(month from sysdate) <= 7)
                THEN TERMS.Abbreviation||' '||to_char(EXTRACT(year from sysdate)-1)||'-'||to_char(EXTRACT(year from sysdate))
                WHEN (EXTRACT(month from sysdate) > 7 and EXTRACT(month from sysdate) <= 12)
                THEN to_char(EXTRACT(year from sysdate))||'-'||to_char(EXTRACT(year from sysdate))
                END
                as "name",
                '' as "start_date",
                '' as "end_date",
                '' as "is_active",
                '' as "department_code",
                '' as "template_code",
                '' as "semester_code",
                '' as "offering_code",
                '' as "custom_code"
            from TERMS TERMS 
                where TERMS.YEARID = (CASE 
                WHEN (EXTRACT(month from sysdate) >= 1 and EXTRACT(month from sysdate) <= 7)
                THEN EXTRACT(year from sysdate)-2000+9
                WHEN (EXTRACT(month from sysdate) > 7 and EXTRACT(month from sysdate) <= 12)
                THEN EXTRACT(year from sysdate)-2000+10
                    END)
            order by "code" asc
            ]]>
        </sql>
    </query>

</queries>